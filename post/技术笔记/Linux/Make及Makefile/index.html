<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.zestaken.top","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":true,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Make及Makefile  Make  代码变成可执行文件，叫做编译（compile）；先编译这个，还是先编译那个（即编译的安排），叫做构建（build）。 Make是最常用的构建工具，诞生于1977年，主要用于C语言的项目。但是实际上 ，任何只要某个文件有变化，就要重新构建的项目，都可以用Make构建。 Make这个词，英语的意思是&quot;制作&quot;。Make命令直接用了这个意思，">
<meta property="og:type" content="article">
<meta property="og:title" content="Make及Makefile">
<meta property="og:url" content="http://www.zestaken.top/post/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/Linux/Make%E5%8F%8AMakefile/index.html">
<meta property="og:site_name" content="ZestJourney">
<meta property="og:description" content="Make及Makefile  Make  代码变成可执行文件，叫做编译（compile）；先编译这个，还是先编译那个（即编译的安排），叫做构建（build）。 Make是最常用的构建工具，诞生于1977年，主要用于C语言的项目。但是实际上 ，任何只要某个文件有变化，就要重新构建的项目，都可以用Make构建。 Make这个词，英语的意思是&quot;制作&quot;。Make命令直接用了这个意思，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200829225226.jpg">
<meta property="og:image" content="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200829230330.jpg">
<meta property="og:image" content="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200830190810.jpg">
<meta property="og:image" content="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200830192748.jpg">
<meta property="og:image" content="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200830213731.jpg">
<meta property="article:published_time" content="2020-07-31T14:28:31.000Z">
<meta property="article:modified_time" content="2022-09-17T11:27:52.193Z">
<meta property="article:author" content="Zestaken">
<meta property="article:tag" content="C">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="MakeFile">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200829225226.jpg">


<link rel="canonical" href="http://www.zestaken.top/post/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/Linux/Make%E5%8F%8AMakefile/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://www.zestaken.top/post/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/Linux/Make%E5%8F%8AMakefile/index.html","path":"/post/技术笔记/Linux/Make及Makefile/index.html","title":"Make及Makefile"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Make及Makefile | ZestJourney</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ZestJourney</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">乐游记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#make%E5%8F%8Amakefile"><span class="nav-number">1.</span> <span class="nav-text"> Make及Makefile</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#make"><span class="nav-number">1.1.</span> <span class="nav-text"> Make</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#makefile"><span class="nav-number">1.2.</span> <span class="nav-text"> Makefile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#makefile%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">1.2.1.</span> <span class="nav-text"> Makefile的基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#makefile%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">1.2.1.1.</span> <span class="nav-text"> Makefile是什么？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#makefile%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A7%84%E5%88%99"><span class="nav-number">1.2.1.2.</span> <span class="nav-text"> Makefile中的基本规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#makefile%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-number">1.2.1.3.</span> <span class="nav-text"> Makefile的基本工作流程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#makefile%E4%B8%AD%E7%9A%84%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="nav-number">1.2.2.</span> <span class="nav-text"> Makefile中的通配符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#makefile%E5%8F%98%E9%87%8F%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-number">1.2.3.</span> <span class="nav-text"> Makefile变量的定义和使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">1.2.3.1.</span> <span class="nav-text"> 变量的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.3.2.</span> <span class="nav-text"> 变量的定义方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.3.3.</span> <span class="nav-text"> 自动化变量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#makefile%E7%9A%84%E9%9A%90%E5%90%AB%E8%A7%84%E5%88%99"><span class="nav-number">1.2.4.</span> <span class="nav-text"> Makefile的隐含规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#makefile%E7%9A%84%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="nav-number">1.2.5.</span> <span class="nav-text"> Makefile的条件判断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#makefile%E7%9A%84%E4%BC%AA%E7%9B%AE%E6%A0%87"><span class="nav-number">1.2.6.</span> <span class="nav-text"> Makefile的伪目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#makefile%E7%9A%84%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="nav-number">1.2.7.</span> <span class="nav-text"> Makefile的基础语法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E9%87%8A"><span class="nav-number">1.2.7.1.</span> <span class="nav-text"> 注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E5%A3%B0"><span class="nav-number">1.2.7.2.</span> <span class="nav-text"> 回声</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#makefile%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-number">1.2.7.3.</span> <span class="nav-text"> Makefile中的函数</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zestaken</p>
  <div class="site-description" itemprop="description">吾好梦中读书~</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">84</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">60</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.zestaken.top/post/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/Linux/Make%E5%8F%8AMakefile/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zestaken">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZestJourney">
      <meta itemprop="description" content="吾好梦中读书~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Make及Makefile | ZestJourney">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Make及Makefile
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-07-31 22:28:31" itemprop="dateCreated datePublished" datetime="2020-07-31T22:28:31+08:00">2020-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-09-17 19:27:52" itemprop="dateModified" datetime="2022-09-17T19:27:52+08:00">2022-09-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">技术笔记</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="make及makefile"><a class="markdownIt-Anchor" href="#make及makefile"></a> Make及Makefile</h1>
<h2 id="make"><a class="markdownIt-Anchor" href="#make"></a> Make</h2>
<ul>
<li>代码变成可执行文件，叫做编译（compile）；先编译这个，还是先编译那个（即编译的安排），叫做构建（build）。</li>
<li>Make是最常用的构建工具，诞生于1977年，主要用于C语言的项目。但是实际上 ，任何只要某个文件有变化，就要重新构建的项目，都可以用Make构建。</li>
<li>Make这个词，英语的意思是&quot;制作&quot;。Make命令直接用了这个意思，就是要做出某个文件。make是一个根据指定的Shell命令进行构建的工具。</li>
<li>make命令执行的规则，都写在一个叫做Makefile的文件中，Make命令依赖这个文件进行构建。Makefile文件也可以写为makefile， 或者用命令行参数(<code>make -f &lt;指定的文件名&gt;</code>或者<code>make --file=&lt;指定的文件名&gt;</code>)指定为其他文件名。</li>
</ul>
<h2 id="makefile"><a class="markdownIt-Anchor" href="#makefile"></a> Makefile</h2>
<h3 id="makefile的基本概念"><a class="markdownIt-Anchor" href="#makefile的基本概念"></a> Makefile的基本概念</h3>
<h4 id="makefile是什么"><a class="markdownIt-Anchor" href="#makefile是什么"></a> Makefile是什么？</h4>
<ul>
<li>Makefile 可以简单的认为是一个工程文件的<strong>编译规则</strong>，描述了整个工程的编译和链接等规则。其中包含了那些文件需要编译，那些文件不需要编译，那些文件需要先编译，那些文件需要后编译，那些文件需要重建等等。编译整个工程需要涉及到的，在 Makefile 中都可以进行描述。换句话说，Makefile 可以使得我们的项目工程的<strong>编译变得自动化</strong>，不需要每次都手动输入一堆源文件和参数。</li>
<li>编写Makefile的作用：
<ol>
<li>简化输入的编译命令：在 Makefile 中，制定相应的规则和对应的链接顺序。这样只需要执行 make 命令，工程就会自动编译。每次想要编译工程的时候就执行 make ，省略掉手动编译中的参数选项和命令。</li>
<li>节省编译大工程的时间：Makefile 支持多线程并发操作(就像我们使用的<code>make -j8</code>)，会极大的缩短我们的编译时间，并且当我们修改了源文件之后，编译整个工程的时候，make 命令只会编译我们修改过的文件，没有修改的文件不用重新编译，也极大的解决了我们耗费时间的问题。</li>
</ol>
</li>
</ul>
<h4 id="makefile中的基本规则"><a class="markdownIt-Anchor" href="#makefile中的基本规则"></a> Makefile中的基本规则</h4>
<ul>
<li>
<p>Makefile 描述的是文件编译的相关规则，它的规则主要是两个部分组成，分别是<strong>依赖的关系</strong>和<strong>执行的命令</strong></p>
</li>
<li>
<p>Makefile文件由一系列规则（rules）构成。每条规则的形式如下:</p>
  <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;target&gt; : &lt;prerequisites&gt; 
[tab]  &lt;commands&gt;</code></pre>
<ol>
<li>targets：规则的目标，可以是 Object File（一般称它为中间文件），也可以是可执行文件，还可以是一个标签</li>
<li>prerequisites：规则的条件，是我们的依赖文件，要生成 targets 需要的文件或者是目标。可以是多个，也可以是没有；</li>
<li>command：make 需要执行的命令（任意的 shell 命令）。可以有多条命令，每一条命令占一行。</li>
<li>注意：<strong>我们的目标和依赖文件之间要使用<em>冒号</em>分隔开，命令的开始一定要使用<em>Tab</em>键</strong></li>
</ol>
</li>
<li>
<p>Makefile文件规则概要：</p>
<ol>
<li>显式规则：<br />
显式规则说明了，如何生成一个或多的的<strong>目标文件</strong>。这是由 Makefile 的书写者明显指出，要生成的文件，文件的依赖文件，生成的命令。</li>
<li>隐晦规则<br />
由于我们的 make 命名有<strong>自动推导</strong>的功能，所以隐晦的规则可以让我们比较粗糙地简略地书写 Makefile，这是由 make 命令所支持的。</li>
<li>变量的定义<br />
在 Makefile 中我们要定义一系列的变量，变量一般都是字符串，这个有点像C语言中的<strong>宏</strong>，当 Makefile 被执行时，其中的变量都会被扩展到相应的引用位置上。</li>
<li>文件指示<br />
其包括了三个部分，一个是在一个 Makefile 中<strong>引用</strong>另一个 Makefile，就像C语言中的 include 一样；另一个是指根据某些情况指定 Makefile 中的<strong>有效部分</strong>，就像C语言中的预编译 #if 一样；还有就是定义一个多行的命令。</li>
<li>注释<br />
Makefile 中<strong>只有行注释</strong>，和 UNIX 的 Shell 脚本一样，其注释是<strong>用“#”字符</strong>，这个就像 C/C++ 中的“//”一样。如果你要在你的 Makefile 中使用“#”字符，可以用反斜框进行转义，如：<code>\#</code>。</li>
</ol>
</li>
</ul>
<h4 id="makefile的基本工作流程"><a class="markdownIt-Anchor" href="#makefile的基本工作流程"></a> Makefile的基本工作流程</h4>
<ul>
<li>当我们在执行 make 条命令的时候，make 就会去<strong>当前文件</strong>下找要执行的编译规则，也就是 Makefile 文件。我们编写 Makefile 的时可以使用的文件的名称&quot;GNUmakefile&quot; 、“makefile” 、“Makefile” ，make 执行时回去寻找 Makefile 文件，找文件的顺序也是这样的。我们推荐使用<strong>Makefile</strong>（一般在工程中都这么写，大写的会比较的规范）。如果文件不存在，make 就会给我们报错，提示：<br />
<code>make：*** 没有明确目标并且找不到 makefile。停止</code></li>
<li>工作流程简介：</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">main:main.o test1.o test2.o
  gcc main.o test1.o test2.o -o main
main.o:main.c test.h
  gcc -c main.c -o main.o
test1.o:test1.c test.h
  gcc -c test1.c -o test1.o
test2.o:test2.c test.h
  gcc -c test2.c -o test2.o</code></pre>
<ul>
<li><strong>工作流程</strong>：当在 shell 提示符下输入 make 命令以后。 make 读取当前目录下的 Makefile 文件，并将 Makefile 文件中的<strong>第一个目标作为其执行的“终极目标”</strong>，开始处理第一个规则（终极目标所在的规则）。在我们的例子中，第一个规则就是目标 “main” 所在的规则。规则描述了 “main” 的<strong>依赖关系</strong>，并定义了<strong>链接 “.o” 文件生成目标 “main” 的命令</strong>；make 在执行这个规则所定义的命令之前，<strong>首先处理目标 “main” 的所有的依赖文件</strong>（例子中的那些 “.o” 文件）的更新规则（以这些 “.o” 文件为目标的规则）。</li>
<li>对这些 “.o” 文件为目标的<strong>规则处理</strong>有下列三种情况：
<ul>
<li>目标 “.o” 文件<strong>不存在</strong>，使用其描述规则创建它；</li>
<li>目标 “.o” 文件存在，目标 “.o” 文件所<strong>依赖</strong>的 “.c” 源文件 “.h” 文件中的任何一个比目标 “.o” 文件“更新”（在上一次 make 之后被修改）。则根据规则重新编译生成它；</li>
<li>目标 “.o” 文件存在，目标 “.o” 文件比它的任何一个依赖文件（&quot;.c&quot; 源文件、&quot;.h&quot; 文件）“更新”（它的依赖文件在上一次 make 之后<strong>没有被修改</strong>），则什么也不做。</li>
</ul>
</li>
<li>我们执行 make 命令时，<strong>只有修改过的源文件或者是不存在的目标文件</strong>会进行重建，而那些没有改变的文件不用重新编译，这样在很大程度上节省时间，提高编程效率。</li>
<li>具体命令解析
<ol>
<li><code>main: main.o test1.o test2.o</code>:表示最终目标文件是生成main,而main的生成依赖于main.o test1.o test2.o 这三个汇编文件。</li>
<li><code>gcc mian.o test1.o test2.o -o main</code>:指定了生成main所需要执行的shell命令，即将三个依赖的汇编文件链接输出为main。</li>
<li><code>main.o: main.c test.h</code>:表示main.o文件依赖于main.c和test.h文件，为了生成最终文件main，make会先执行能生成main的依赖文件的命令。</li>
<li><code>gcc -c main.c -o main.o</code>:指定了如何通过依赖文件生成main.o的shell命令，即将main.c文件编译汇编为main.o文件（注意：因为gcc会自动找到头文件及所需的链接库，所以汇编时不用加上头文件test.h，但是在<strong>描述依赖关系时还是要将test.h描述进去</strong>）</li>
</ol>
</li>
<li><strong>清除工作过程中的过程文件</strong>:我们在使用的时候会产生中间文件会让整个文件看起来很乱，所以在编写 Makefile 文件的时候会在末尾加上这样的规则语句：</li>
</ul>
  <pre class="line-numbers language-none"><code class="language-none">.PHONY:clean
clean:
rm -rf *.o </code></pre>
<p>其中 “*.o” 是执行过程中产生的中间文件，“test” 是最终生成的执行文件。(具体要删除什么文件，可以自行指定);可以在命令行中指定Makefile中的一个文件作为目标，那么这条make命令就只更新这个指定的目标(如：<code>make clean</code>，如果没有指定目标则make默认更新Makefile中的第一条规则的目标。</p>
<h3 id="makefile中的通配符"><a class="markdownIt-Anchor" href="#makefile中的通配符"></a> Makefile中的通配符</h3>
<ul>
<li>由于Makefile是使用shell命令的，所以shell命令中的通配符在Makefile中也是适用的。</li>
</ul>
<table>
<thead>
<tr>
<th>通配符</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>匹配任意个字符,如<code>*.o</code>代表在当前文件夹下所有以<code>.o</code>结尾的文件</td>
</tr>
<tr>
<td><code>?</code></td>
<td>匹配一个字符</td>
</tr>
<tr>
<td><code>[]</code></td>
<td>匹配指定的字符，指定的字符放在<code>[]</code>中，如<code>[zhangjie].o</code></td>
</tr>
<tr>
<td><code>~</code></td>
<td>类似于shell中打开目录时的<code>~</code>，后面为空或者接分隔符<code>/</code>或者接路径名或者文件名的时候，代表根目录。如<code>~/bin</code>代表<code>/home/usrname/bin</code>,<code>~zhangjie/bin</code>代表<code>/home/zhangjie/bin</code></td>
</tr>
</tbody>
</table>
<h3 id="makefile变量的定义和使用"><a class="markdownIt-Anchor" href="#makefile变量的定义和使用"></a> Makefile变量的定义和使用</h3>
<h4 id="变量的定义"><a class="markdownIt-Anchor" href="#变量的定义"></a> 变量的定义</h4>
<ul>
<li>变量的定义：
<ul>
<li>变量是用来存储一个值或者使用来进行运算操作，可以用来表示多处出现而内容又可能发生变化的内容。</li>
<li>Makefile中的变量不像c语言中一样,没有数据类型。</li>
<li>变量的名称可以由字母，阿拉伯数字和下划线组成。</li>
<li>变量的定义语句：<code>变量 = 值列表</code>(其中值列表既可以是零项，又可以是一项或者多项),例如：<code>value = 1 2 3</code>,一个变量的定义从<code>=</code>后面的第一个非空白字符开始，包括后面所有的字符，直到注释或者换行之前结束。</li>
</ul>
</li>
<li>变量的调用：
<ul>
<li>调用变量可以使用<code>$(value)</code>,<code>$&#123;value&#125;</code>.</li>
<li>示例：  <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">OBJ &#x3D; mian.o test.o 
test: $(OBJ)
  gcc $&#123;OBJ&#125; -o test</code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="变量的定义方法"><a class="markdownIt-Anchor" href="#变量的定义方法"></a> 变量的定义方法</h4>
<ul>
<li>简单赋值：<code>:=</code>,编程中常见的变量赋值，只对当前语句有赋值效果,即遇到这种赋值就立即展开。</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">x :&#x3D; foo
y :&#x3D; $(x)b
x :&#x3D; new
test:
  @echo &quot;y &#x3D;&gt; $(y)&quot;
  @echo &quot;x &#x3D;&gt; $(x)&quot;</code></pre>
<p>结果：<br />
<img src="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200829225226.jpg" alt="" /></p>
<ul>
<li>递归赋值：<code>=</code>,又叫做迟滞展开，每次使用的变量都是用的最新的定义，所以这种方式甚至能做到等式右边的式子中的变量在之后才被定义,即遇到递归赋值，会在使用整个变量时才将它展开。</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">x :&#x3D; foo
y &#x3D; $(x)b
x :&#x3D; new
test:
  @echo &quot;y &#x3D;&gt; $(y)&quot;
  @echo &quot;x &#x3D;&gt; $(x)&quot;</code></pre>
<p>结果：<br />
<img src="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200829230330.jpg" alt="" /></p>
<ul>
<li>
<p>与简单赋值不同的是，递归赋值y中的x使用的是在最后赋给x的new,而不是开始就赋给x的foo(实际上递归赋值相当于最后在使用y变量的时候，才将y的赋值式代入，此时它前面已经又有了对x的新的赋值，所以最后呈现出来的是x最后的赋值,也因此把对x的第二个赋值语句改为简单赋值也是同样的输出)。</p>
</li>
<li>
<p>条件赋值：<code>?=</code>如果当前变量从未被赋值过，则相当于<code>=</code>;但如果当前变量已将被赋值过，则什么也不做，不会再重新赋值。</p>
</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">x :&#x3D; foo
y :&#x3D; $(x)b
x ?&#x3D; new
test:
  @echo &quot;y &#x3D;&gt; $(y)&quot;
  @echo &quot;x &#x3D;&gt; $(x)&quot;</code></pre>
<p><img src="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200830190810.jpg" alt="" /></p>
<ul>
<li>
<p>最后给x的条件赋值实际没有任何效果。</p>
</li>
<li>
<p>追加赋值：<code>+=</code>,追加赋值类似于c语言中的<code>+=</code>,可理解为变量本身再在后面加上<code>+=</code>后面的值，但是不同定义得到的变量它的<code>+=</code>的理解会有不同。比如说，如果变量object使用<code>:=</code>定义的，那么<code>object += foo</code>,与<code>object := $(object) foo</code>,注意最后合成的object的两部分的变量间会自动生成一个空格。</p>
</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">x :&#x3D; foo
y :&#x3D; $(x)b
x +&#x3D; $(y)
test:
  @echo &quot;y &#x3D;&gt; $(y)&quot;
  @echo &quot;x &#x3D;&gt; $(x)&quot;</code></pre>
<p>结果：<br />
<img src="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200830192748.jpg" alt="" /></p>
<h4 id="自动化变量"><a class="markdownIt-Anchor" href="#自动化变量"></a> 自动化变量</h4>
<ul>
<li><code>$@</code>:表示规则中的目标</li>
<li><code>$&lt;</code>:表示规则中的第一个条件（即第一个依赖文件）</li>
<li><code>$?</code>:表示规则中所有比目标新的条件，组成一个列表，以空格分隔</li>
<li><code>$^</code>:表示规则中的所有条件(即所有依赖文件)</li>
</ul>
<h3 id="makefile的隐含规则"><a class="markdownIt-Anchor" href="#makefile的隐含规则"></a> Makefile的隐含规则</h3>
<ul>
<li>在Makefile中有内置的隐含规则可以使我们省略对一些规则的命令的编写。</li>
</ul>
<h3 id="makefile的条件判断"><a class="markdownIt-Anchor" href="#makefile的条件判断"></a> Makefile的条件判断</h3>
<ul>
<li>在Makefile编译文件时可能会遇到需要分条件使用不同命令的情况，这时可以使用Makefile的条件编译语句。</li>
<li>常用条件判断的关键字：</li>
</ul>
<table>
<thead>
<tr>
<th>关键字</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>ifeq</td>
<td>判断参数是否相等，相等为true，不相等为false</td>
</tr>
<tr>
<td>ifneq</td>
<td>判断参数是否不相等，不相等为true，相等为false</td>
</tr>
<tr>
<td>ifef</td>
<td>判断是否有值，有值为true，无值为false</td>
</tr>
<tr>
<td>ifnef</td>
<td>判断是否无值，无值为true，有值为false</td>
</tr>
</tbody>
</table>
<h3 id="makefile的伪目标"><a class="markdownIt-Anchor" href="#makefile的伪目标"></a> Makefile的伪目标</h3>
<ul>
<li>伪目标：这个目标没有任何依赖文件，但是有命令，它最终的结果并不会生成任何目标文件，而只是执行该规则下的命令。</li>
<li>伪目标的创建：<code>.PHONY:变量名</code></li>
<li>伪目标的应用：
<ul>
<li>执行一些没有文件产生的命令，如删除</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">.PHONY:clean
clean:
  rm -rf *.o </code></pre>
<ul>
<li>一个make命令产生多可执行文件，提升make的效率。</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">.PHONY:all
all:test1, test2, test3

test1: test1.o
  gcc $^ -o $@
test2: test2.o
  gcc $^ -o $@
test3: test3.o
  gcc $^ -o $@</code></pre>
<p>*如果只想生成一个test1文件，可以用<code>make test1</code>。</p>
<h3 id="makefile的基础语法"><a class="markdownIt-Anchor" href="#makefile的基础语法"></a> Makefile的基础语法</h3>
<h4 id="注释"><a class="markdownIt-Anchor" href="#注释"></a> 注释</h4>
<ul>
<li>Makefile类似Python，在每一行后以<code>#</code>来开始注释。</li>
</ul>
<h4 id="回声"><a class="markdownIt-Anchor" href="#回声"></a> 回声</h4>
<ul>
<li>默认情况下，make会打印它执行的命令行，这叫做“回声”。<br />
<img src="https://zjpicture.oss-cn-beijing.aliyuncs.com/giteePic/picgo-master/img/20200830213731.jpg" alt="" /></li>
<li>在每行命令前加上<code>@</code>符号就可以关闭回声，例如经常使用的<code>@echo</code></li>
</ul>
<h4 id="makefile中的函数"><a class="markdownIt-Anchor" href="#makefile中的函数"></a> Makefile中的函数</h4>
<p>Makefile中有许多<a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/manual/html_node/Functions.html">内置函数</a>可以调用。</p>
<hr />
<p>参考资料：<br />
<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2015/02/make.html">阮一峰的博客</a><br />
<a target="_blank" rel="noopener" href="http://c.biancheng.net/makefile/">C语言中文网</a><br />
<a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/">GNU make</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"># C</a>
              <a href="/tags/Linux/" rel="tag"># Linux</a>
              <a href="/tags/MakeFile/" rel="tag"># MakeFile</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/%E4%B8%93%E4%B8%9A%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%AC%AC%E4%B8%89%E7%AB%A0%20%E6%A0%88%E4%B8%8E%E9%98%9F%E5%88%97/index.html" rel="prev" title="第三章 栈与队列">
                  <i class="fa fa-angle-left"></i> 第三章 栈与队列
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/%E4%B8%93%E4%B8%9A%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E7%AC%AC%E5%9B%9B%E7%AB%A0%20%E4%B8%B2/index.html" rel="next" title="第四章 串">
                  第四章 串 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Zestaken</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">678k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:17</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js" integrity="sha256-4mJNT2bMXxcc1GCJaxBmMPdmah5ji0Ldnd79DKd1hoM=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha256-AjM0J5XIbiB590BrznLEgZGLnOQWrt62s3BEq65Q/I0=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js" integrity="sha256-9cmf7tcLdXpKsPi/2AWE93PbZpTp4M4tqzFk+lWomjU=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
